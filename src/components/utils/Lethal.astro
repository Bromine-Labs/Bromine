---

---

<script>
  // --- LETHAL IMPORTS ---
  import {
    setTransport,
    setWisp,
    makeURL,
    getProxied,
    setFrames,
    addressInput,
    currentTab,
    Tab,
  } from "@/utils/lethal";

  // --- INIT ---
  const form = document.getElementById("form");
  let search =
    localStorage.getItem("bromine_search_engine") ||
    "https://duckduckgo.com/search?q=%s";

  let wisp = localStorage.getItem("bromine_wisp") || "wss://anura.pro/";
  let transport = localStorage.getItem("bromine_transport");

  setWisp(wisp);

  if (transport) setTransport(transport as Transport);
  else if (navigator.userAgent.indexOf("Firefox") > 0) setTransport("libcurl");
  else setTransport("epoxy");

  // --- EVENTS ---
  form?.addEventListener("submit", async (event) => {
    event.preventDefault();

    const urlToLoad = makeURL(addressInput.value, search);
    const proxiedUrl = await getProxied(urlToLoad);

    let currentFrame = document.getElementById(
      `frame-${currentTab}`,
    ) as HTMLIFrameElement;

    if (localStorage.getItem("bromine_stealth_mode")) {
      currentFrame?.contentWindow?.location.replace(proxiedUrl);
    } else {
      currentFrame.src = proxiedUrl;
    }
    if (currentFrame === document.getElementById(`frame-${currentTab}`))
      addressInput.value = urlToLoad;
  });

  window.addEventListener("bromine_search_engine_changed", () => {
    search = localStorage.getItem("bromine_search_engine") as string;
  });

  window.addEventListener("bromine_wisp_changed", () => {
    wisp = localStorage.getItem("bromine_wisp") as string;
    setWisp(localStorage.getItem("bromine_wisp") as string);
  });

  window.addEventListener("bromine_transport_changed", () => {
    transport = localStorage.getItem("bromine_transport") as Transport;
    setTransport(localStorage.getItem("bromine_transport") as Transport);
  });

  setFrames(document.getElementById("frames") as HTMLElement);
</script>
