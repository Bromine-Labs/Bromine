---
---
<script type="module">
      import { setTransport, setWisp, makeURL, getProxied } from './lethal.mjs';
      // tabStore import removed

      const form = document.getElementById('uv-form');
      const addressInput = document.getElementById("uv-address"); // Get address input once

      if (navigator.userAgent.indexOf("Firefox") > 0) setTransport('libcurl');
      else setTransport("epoxy");

      setWisp("wss://wisp.rhw.one/");
      // setWisp('wss://wisp.mercurywork.shop/wisp/');

      if (form) {
        form.addEventListener("submit", async (event) => {
          event.preventDefault();
          
          const frame = document.getElementById('uv-frame'); // Target the static iframe

          if (!frame) {
            console.error("Lethal.astro: Could not find iframe #uv-frame.");
            return;
          }
          if (!addressInput) { // Check if addressInput was found initially
            console.error("Lethal.astro: Could not find address input #uv-address.");
            return;
          }

          const urlToLoad = addressInput.value;
          try {
            frame.src = await getProxied(makeURL(urlToLoad)); 
            // No need to update tabStore with the URL
          } catch (e) {
            console.error("Error loading URL in Lethal.astro:", e);
            // Handle error (e.g., show message to user or in UI)
          }
        });
      } else {
        console.error("Lethal.astro: UV form (uv-form) not found.");
      }
    </script>
